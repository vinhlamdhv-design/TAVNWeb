rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // 1. Cho phép người dùng đã đăng nhập đọc/ghi dữ liệu vai trò của chính họ
    // Quan trọng: Chỉ người dùng có thể đọc document của chính mình (docId == request.auth.uid)
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // 2. Cho phép người dùng đã đăng nhập đọc tất cả lệnh công tác để hiển thị dashboard
    // Cho phép người dùng chưa đăng nhập tạo lệnh (write)
    match /lenh_cong_tac/{lenhId} {
      // Cho phép tất cả người dùng tạo lệnh (người tạo lệnh không cần đăng nhập)
      allow create: if true; 
      
      // Cho phép người dùng đã đăng nhập đọc và cập nhật (phê duyệt)
      allow read, update: if request.auth != null; 
    }
  }
}
